# Chain of Thought Reasoning 思維鏈推理
Process Inputs: Chain of Thought Reasoning 過程輸入: 思維鏈推理

:::info
幫助模型逐步分解複雜問題，並通過一系列推理步驟得出最終結論。
:::
* 透過重新設計提示，要求模型先思考、後回答，逐步指導模型，幫助模型避免錯誤，確保其推理的每一步都得到充分的考慮，提升邏輯與回答品質。
* 有時這些非常詳細的指示對於像GPT-4這樣的高級語言模型來說可能不太必要。
* 適用場景：需要深度推理的任務，如推理比較、錯誤識別、邏輯分析等。

---

## 內心獨白（Inner Monologue） 
:::info
用來在背景中隱藏模型的推理過程，只顯示最終的結果給使用者，是一種隱藏推理過程的技巧。
:::
* 模型在內部完成多步推理，但只將最終結果呈現給用戶。將推理藏起來，只顯示回應，提升使用者體驗。
    * 指示模型輸出結構化格式，包含那些預定隱藏的輸出部分
    * 呈現給用戶之前，輸出會先經過處理，只顯示最後的回應部分
* 建議測試多種提示版本，找到「推理完整性與簡潔性」之間的最佳平衡。
* 適用場景：避免給出解答步驟（如教育輔導系統），鼓勵用戶自行思考。

---

## 說明範例: 客服產品詢問
推理步驟設計：
按照以下步驟來回答顧客的查詢。顧客的查詢將以四個井號（#）作為分隔符。
* 步驟 1： "判斷使用者是否詢問特定產品（而不是類別）。"
* 步驟 2： "若有提及產品，檢查是否在商店提供的產品列表中。"
    * 主類別: 一般詢問
    * 次類別: 產品資訊
* 步驟 3： "若提及產品，列出使用者可能的隱含假設（例如「某產品比較貴」）。"
* 步驟 4： "驗證這些假設是否正確。"
* 步驟 5： "若有錯誤假設，禮貌更正並給出正確資訊。只回答清單中的產品。"

```python
delimiter = "####"
system_message = f"""
Follow these steps to answer the customer queries.
The customer query will be delimited with four hashtags,\
i.e. {delimiter}. 

# 判斷顧客是否在詢問具體的產品或產品。如果是產品類別問題則不計算。
Step 1:{delimiter} First decide whether the user is \
asking a question about a specific product or products. \
Product cateogry doesn't count. 

# 如果顧客詢問的是具體產品，判斷這些產品是否在以下列表中。
Step 2:{delimiter} If the user is asking about \
specific products, identify whether \
the products are in the following list.
All available products: 
1. Product: TechPro Ultrabook
   Category: Computers and Laptops
   Brand: TechPro
   Model Number: TP-UB100
   Warranty: 1 year
   Rating: 4.5
   Features: 13.3-inch display, 8GB RAM, 256GB SSD, Intel Core i5 processor
   Description: A sleek and lightweight ultrabook for everyday use.
   Price: $799.99

2. Product: BlueWave Gaming Laptop
   Category: Computers and Laptops
   Brand: BlueWave
   Model Number: BW-GL200
   Warranty: 2 years
   Rating: 4.7
   Features: 15.6-inch display, 16GB RAM, 512GB SSD, NVIDIA GeForce RTX 3060
   Description: A high-performance gaming laptop for an immersive experience.
   Price: $1199.99

3. Product: PowerLite Convertible
   Category: Computers and Laptops
   Brand: PowerLite
   Model Number: PL-CV300
   Warranty: 1 year
   Rating: 4.3
   Features: 14-inch touchscreen, 8GB RAM, 256GB SSD, 360-degree hinge
   Description: A versatile convertible laptop with a responsive touchscreen.
   Price: $699.99

4. Product: TechPro Desktop
   Category: Computers and Laptops
   Brand: TechPro
   Model Number: TP-DT500
   Warranty: 1 year
   Rating: 4.4
   Features: Intel Core i7 processor, 16GB RAM, 1TB HDD, NVIDIA GeForce GTX 1660
   Description: A powerful desktop computer for work and play.
   Price: $999.99

5. Product: BlueWave Chromebook
   Category: Computers and Laptops
   Brand: BlueWave
   Model Number: BW-CB100
   Warranty: 1 year
   Rating: 4.1
   Features: 11.6-inch display, 4GB RAM, 32GB eMMC, Chrome OS
   Description: A compact and affordable Chromebook for everyday tasks.
   Price: $249.99

# 如果訊息包含上述產品列表中的產品，列出顧客在訊息中做出的假設。例如，顧客可能假設筆記型電腦X比筆記型電腦Y更大，或筆記型電腦Z有兩年保固等。
Step 3:{delimiter} If the message contains products \
in the list above, list any assumptions that the \
user is making in their \
message e.g. that Laptop X is bigger than \
Laptop Y, or that Laptop Z has a 2 year warranty.

# 如果顧客做出了假設，根據產品資訊判斷這些假設是否正確。
Step 4:{delimiter}: If the user made any assumptions, \
figure out whether the assumption is true based on your \
product information. 

# 首先，禮貌地更正顧客的不正確假設（如果適用）。只提及或引用列表中的五款產品，因為這些是商店唯一賣的產品。並以友好的語氣回答顧客。
Step 5:{delimiter}: First, politely correct the \
customer's incorrect assumptions if applicable. \
Only mention or reference products in the list of \
5 available products, as these are the only 5 \
products that the store sells. \
Answer the customer in a friendly tone.

Use the following format:
Step 1:{delimiter} <step 1 reasoning>
Step 2:{delimiter} <step 2 reasoning>
Step 3:{delimiter} <step 3 reasoning>
Step 4:{delimiter} <step 4 reasoning>
Response to user:{delimiter} <response to customer>

Make sure to include {delimiter} to separate every step.
"""
```
用戶查詢在清單中的產品資訊
```python
user_message = f"""
by how much is the BlueWave Chromebook more expensive \
than the TechPro Desktop"""

messages =  [  
{'role':'system', 
 'content': system_message},    
{'role':'user', 
 'content': f"{delimiter}{user_message}{delimiter}"},  
] 

response = get_completion_from_messages(messages)
print(response)
```
查無此商品
```python
user_message = f"""
do you sell tvs"""
messages =  [  
{'role':'system', 
 'content': system_message},    
{'role':'user', 
 'content': f"{delimiter}{user_message}{delimiter}"},  
] 
response = get_completion_from_messages(messages)
print(response)
```
過濾掉推理部分，只保留「回應使用者的部分」。
加上 try-except 來防止模型格式錯誤導致程式中斷。
```python
try:
    final_response = response.split(delimiter)[-1].strip()
except Exception as e:
    final_response = "Sorry, I'm having trouble right now, please try asking another question."
    
print(final_response)
```

---
