# Inferring 推論
推論（Inference）任務：
* 輸入一段文字，產出某種分析或理解結果

可應用於：
* 情緒分析、資訊擷取、主題偵測、客戶反饋分類、新聞監控...等。

---

## LLM 推論的優勢
| 傳統方法（機器學習） | 使用 LLM 提示語（Prompting） |
| -------- | -------- |
| 需蒐集標註資料     | 不需資料集，零樣本學習（Zero-shot learning） 即可用     | 
| 訓練多個模型（如情感判斷、名稱提取或其他任務）     | 一個模型可處理多種任務     | 
| 雲端部署、API管理較麻煩     | 一行提示語 + API 調用即可開始     | 
| 開發週期長     | 幾分鐘內開始運作     | 

零樣本學習（Zero-shot learning）」，:
沒有給它任何標註過的訓練資料

---

## 情緒分析

### 商品評論文本
一篇關於一盞燈的評論
```python
lamp_review = """
Needed a nice lamp for my bedroom, and this one had \
additional storage and not too high of a price point. \
Got it fast.  The string to our lamp broke during the \
transit and the company happily sent over a new one. \
Came within a few days as well. It was easy to put \
together.  I had a missing part, so I contacted their \
support and they very quickly got me the missing piece! \
Lumina seems to me to be a great company that cares \
about their customers and products!!
"""
```

### 情緒（正面/負面）
判斷這段評論的情感。
```python
prompt = f"""
# ---------------------------------------------------------
# 以下產品評論的情緒是什麼？
# 哪一個是用三個反引號分隔的？
# 
# 評論文字：...
# ---------------------------------------------------------
What is the sentiment of the following product review, 
which is delimited with triple backticks?

Review text: '''{lamp_review}'''
"""
response = get_completion(prompt)
print(response)
```
更簡潔的回應，讓後續處理更方便，也可以修改提示，要求它只輸出單字的答案，例如「正面」或「負面」。
```python
# ---------------------------------------------------------
# 以下產品評論的情緒是什麼？
# 哪一個是用三個反引號分隔的？
# 
# 用一個字來回答，可以是「正面」或「負面」。
# 
# 評論文字：...
# ---------------------------------------------------------
prompt = f"""
What is the sentiment of the following product review, 
which is delimited with triple backticks?

Give your answer as a single word, either "positive" \
or "negative".

Review text: '''{lamp_review}'''
"""
response = get_completion(prompt)
print(response)
```

### 辨識情緒類型
大型語言模型在從文字中擷取特定資訊方面非常擅長。
擷取多種情緒。
```python
# ---------------------------------------------------------
# 確定以下評論作者所表達的情感清單。清單中包含的項目不超過五項。
# 將您的答案格式化為以逗號分隔的小寫單字清單。
# 
# 評論文字：...
# ---------------------------------------------------------
prompt = f"""
Identify a list of emotions that the writer of the \
following review is expressing. Include no more than \
five items in the list. Format your answer as a list of \
lower-case words separated by commas.

Review text: '''{lamp_review}'''
"""
response = get_completion(prompt)
print(response)
```

### 辨識憤怒
如果某人真的很生氣，那可能值得讓客服團隊特別關注，主動聯繫顧客並解決問題。
```python
# ---------------------------------------------------------
# 以下評論的作者是在表達憤怒嗎？
# 評論以三個反引號分隔。
# 請給出“是”或“否”的答案。
# 
# 評論文字：...
# ---------------------------------------------------------
prompt = f"""
Is the writer of the following review expressing anger?\
The review is delimited with triple backticks. \
Give your answer as either yes or no.

Review text: '''{lamp_review}'''
"""
response = get_completion(prompt)
print(response)
```

---

## 資訊擷取

### 從客戶評論中提取產品和公司名稱
「資訊擷取」是自然語言處理（NLP）的一部分，它的目的是從一段文字中抽出你想要的特定資訊。

想要總結一大堆線上購物評論，知道買的是什麼、誰製造的、是正面還是負面情感，這些資料都非常有用，可以幫你追蹤特定產品或廠商的情緒趨勢。
```python
# ---------------------------------------------------------
# 從評論文本中識別以下內容：
# - 評論者購買的商品
# - 生產該產品的公司
# 
# 評論以三個反引號分隔。
# 將您的回應格式化為 JSON 對象，並以“Item”和“Brand”作為鍵。
# 如果資訊不存在，則使用“未知”作為值。
# 讓你的回答盡可能簡短。
# 
# 評論文字：...
# ---------------------------------------------------------
prompt = f"""
Identify the following items from the review text: 
- Item purchased by reviewer
- Company that made the item

The review is delimited with triple backticks. \
Format your response as a JSON object with \
"Item" and "Brand" as the keys. 
If the information isn't present, use "unknown" \
as the value.
Make your response as short as possible.
  
Review text: '''{lamp_review}'''
"""
response = get_completion(pro
```

---

## 同時執行多項任務
可以用三到四個不同提示、各自呼叫一次 get_completion() 來做這些任務，但你也可以只用一個提示，同時擷取所有這些資訊。
```python
# ---------------------------------------------------------
# 從評論文本中識別以下內容：
# - 情緒（正面或負面）
# - 評論者是否表達了憤怒？ （正確或錯誤）
# - 評論者購買的商品
# - 生產該產品的公司
# 
# 評論以三個反引號分隔。
# 將您的回應格式化為 JSON 對象，並以「情緒」、「憤怒」、「項目」和「品牌」作為鍵。
# 如果資訊不存在，則使用「未知」作為值。
# 將憤怒值格式化為布林值。
# 
# 評論文字：...
# ---------------------------------------------------------
prompt = f"""
Identify the following items from the review text: 
- Sentiment (positive or negative)
- Is the reviewer expressing anger? (true or false)
- Item purchased by reviewer
- Company that made the item

The review is delimited with triple backticks. \
Format your response as a JSON object with \
"Sentiment", "Anger", "Item" and "Brand" as the keys.
If the information isn't present, use "unknown" \
as the value.
Make your response as short as possible.
Format the Anger value as a boolean.

Review text: '''{lamp_review}'''
"""
response = get_completion(prompt)
print(response)
```

---

## 推斷主題
給一段長文，推斷出主題
```python
story = """
In a recent survey conducted by the government, 
public sector employees were asked to rate their level 
of satisfaction with the department they work at. 
The results revealed that NASA was the most popular 
department with a satisfaction rating of 95%.

One NASA employee, John Smith, commented on the findings, 
stating, "I'm not surprised that NASA came out on top. 
It's a great place to work with amazing people and 
incredible opportunities. I'm proud to be a part of 
such an innovative organization."

The results were also welcomed by NASA's management team, 
with Director Tom Johnson stating, "We are thrilled to 
hear that our employees are satisfied with their work at NASA. 
We have a talented and dedicated team who work tirelessly 
to achieve our goals, and it's fantastic to see that their 
hard work is paying off."

The survey also revealed that the 
Social Security Administration had the lowest satisfaction 
rating, with only 45% of employees indicating they were 
satisfied with their job. The government has pledged to 
address the concerns raised by employees in the survey and 
work towards improving job satisfaction across all departments.
```

### 推斷 5 個主題
```python
# ---------------------------------------------------------
# 確定以下文本中要討論的五個主題，以三重反引號分隔。 
# 使每個項目的長度為一到兩個單字。 
# 將您的回覆格式化為以逗號分隔的項目清單。
# 
# 文字範例：...
# ---------------------------------------------------------
prompt = f"""
Determine five topics that are being discussed in the \
following text, which is delimited by triple backticks.

Make each item one or two words long. 

Format your response as a list of items separated by commas.

Text sample: '''{story}'''
"""
response = get_completion(prompt)
print(response)
```
```python
response.split(sep=',')
```
```python
topic_list = [
    "nasa", "local government", "engineering", 
    "employee satisfaction", "federal government"
]
```

---

## 新聞監控

### 針對特定主題發出新聞提醒
如果你有一堆文章，想要萃取主題，你也可以讓語言模型幫你建出索引。
```python
# ---------------------------------------------------------
# 確定以下主題清單中的每個項目是否為下面文本中的主題，該主題以三重反引號分隔。
#
# 請給以下答案：
# 清單中的項目：0 或 1
# 主題列表：...
# 文本範例：...
# ---------------------------------------------------------
prompt = f"""
Determine whether each item in the following list of \
topics is a topic in the text below, which
is delimited with triple backticks.

Give your answer as follows:
item from the list: 0 or 1

List of topics: {", ".join(topic_list)}

Text sample: '''{story}'''
"""
response = get_completion(prompt)
print(response)
```
建立一個字典，每當出現關於 NASA 的文章，就顯示警告。
```python
topic_dict = {i.split(': ')[0]: int(i.split(': ')[1]) for i in response.split(sep='\n')}
if topic_dict['nasa'] == 1:
    print("ALERT: New NASA story!")
```

---

## 小提醒
| 問題 | 建議 |
| -------- | -------- |
| 輸出格式不一致     | 建議提示語中指定使用 JSON 輸出     |
| 欄位拼寫、格式錯誤     | 在提示語中要求明確欄位與資料型別     |
| 多次請求影響效能     | 可將多項推論合併於單一提示語中執行     |


---

