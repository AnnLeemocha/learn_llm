# Iterative 迭代
Iterative Prompt Development 迭代快速開發
* 不論是機器學習模型或是大型語言模型（LLM），幾乎從來沒有在第一次嘗試就寫出最終會用在應用中的提示（prompt）。
* 第一次是否成功並不重要，重要的是你是否有一個良好的流程，去開發出適合你應用的提示。
* 只要你有一套好的迭代流程，能夠一步步改進你的提示，你最終就能寫出一個能有效完成任務的好提示。
  (不需要迷信「網路上的30個完美提示語」) 
* 成為高效的提示語開發者的核心能力是：建立一套自己的迭代流程。

---

## 迭代快速開發
開發流程圖 (機器學習 & 提示語)

![Iterative Prompt Development](images/Iterative%20Prompt%20Development.png)

1. 構想階段：決定任務和目標。
    * 有想法，準備將其實現。
2. 初步實作：(代碼/數據) 提示
    * ML：
      收集資料、撰寫程式、訓練模型。
    * LLM：
      撰寫提示語。(初版，迭代後更新)
      希望它夠清楚、具體，必要時讓模型有思考時間。
3. 觀察輸出：
    * 評估模型或 LLM 的表現。
4. 錯誤分析與改進：
    * 找出不理想的地方並改寫提示語（或 ML 模型）。
    * 查看該輸出，進行錯誤分析，找出哪些地方有效、哪些無效，然後甚至重新思考要解決的問題或改變做法。
      指令不夠清楚？可能沒有讓模型有足夠的「思考空間」？
5. 重複以上流程，持續改善。
    * 不斷調整、反覆實驗、改進提示的過程，就是提示工程的精髓。
    * 透過迭代過程可以找出為什麼指令不夠清晰，或者為什麼沒有給演算法足夠的時間思考，從而改進想法、改進提示等等，並多次重複這個循環，直到最終得到適合您的應用程式的提示。

### 提示指南
* 清晰具體
* 分析為什麼結果沒有給出期望的輸出。
* 完善想法和提示
* 重複

#### 請記得提示原則
* 明確與具體：清楚說明任務、目標、格式要求。
* 讓模型有思考空間：例如用「逐步推理（chain of thought）」來幫助推理。

### 迭代過程
* 嘗試一些東西
* 分析結果不符合您的要求
* 明確指示，給予更多時間思考
* 使用一批範例來優化提示

#### 測試與評估與升級
* 初期階段：
  可只用 1 個例子來反覆試驗與改寫。
* 成熟階段：
  建議用多個（10、50、100+）測試樣本，並用量化方式評估表現（例如平均輸出品質、最差案例分析）
  
---

## 範例： 根據產品說明書產生行銷產品描述
將一張椅子的產品說明表（fact sheet）轉換為零售網站上的行銷描述。

### 初始任務：
幫助行銷團隊根據技術規格表撰寫一段適用於零售網站的產品描述。

### 迭代過程：
1. 第一次嘗試：
   * 提示語：請根據技術規格表撰寫一段描述，編寫產品描述等等。
   * 問題(1)：**文字過長。**
       * 限制單字/句子/字元的數量。
2. 第二次改進：
   * 提示語：限制「最多50字。最多3句話。最多280個字元。」。
       * 可能無法完美符合限制規則
       * 輸出文字可能介於40-60字之間
   * 問題(2)：文本注意錯誤的細節
       * 要求它專注於與目標受眾相關的方面。
3. 第三次改進：
   * 提示語：指定「對象為傢俱零售商，應注重技術細節，以及產品的材料與結構」。(加入)請列出產品 ID。
       * 更專業、強調材料與製程。
       * 包含產品編號 SWC-110、SWC-100。
   * 問題(3)：描述需要尺寸表
       * 要求它提取資訊並將其組織在表格中。
4. 第四次改進：
    * 提示語：加入一個表格顯示產品尺寸。
    * 問題(N)：...
5. 第四次進階版本：
    視任務而定地加入格式說明（如 HTML、JSON、表格等）
    * 提示語：「以 HTML 格式輸出，並加入產品尺寸表格」。
        * 完整 HTML，含段落與表格，視覺上完整清楚。

### 程式碼：

#### 第一次嘗試：請根據技術規格表撰寫一段描述
```python
fact_sheet_chair = """
OVERVIEW
- Part of a beautiful family of mid-century inspired office furniture, 
including filing cabinets, desks, bookcases, meeting tables, and more.
- Several options of shell color and base finishes.
- Available with plastic back and front upholstery (SWC-100) 
or full upholstery (SWC-110) in 10 fabric and 6 leather options.
- Base finish options are: stainless steel, matte black, 
gloss white, or chrome.
- Chair is available with or without armrests.
- Suitable for home or business settings.
- Qualified for contract use.

CONSTRUCTION
- 5-wheel plastic coated aluminum base.
- Pneumatic chair adjust for easy raise/lower action.

DIMENSIONS
- WIDTH 53 CM | 20.87”
- DEPTH 51 CM | 20.08”
- HEIGHT 80 CM | 31.50”
- SEAT HEIGHT 44 CM | 17.32”
- SEAT DEPTH 41 CM | 16.14”

OPTIONS
- Soft or hard-floor caster options.
- Two choices of seat foam densities: 
 medium (1.8 lb/ft3) or high (2.8 lb/ft3)
- Armless or 8 position PU armrests 

MATERIALS
SHELL BASE GLIDER
- Cast Aluminum with modified nylon PA6/PA66 coating.
- Shell thickness: 10 mm.
SEAT
- HD36 foam

COUNTRY OF ORIGIN
- Italy
"""
```
```python
prompt = f"""
Your task is to help a marketing team create a 
description for a retail website of a product based 
on a technical fact sheet.

Write a product description based on the information 
provided in the technical specifications delimited by 
triple backticks.

Technical specifications: ```{fact_sheet_chair}```
"""
response = get_completion(prompt)
print(response)
```

#### 問題(1)：文字過長。
```python
prompt = f"""
Your task is to help a marketing team create a 
description for a retail website of a product based 
on a technical fact sheet.

Write a product description based on the information 
provided in the technical specifications delimited by 
triple backticks.

Use at most 50 words.

Technical specifications: ```{fact_sheet_chair}```
"""
response = get_completion(prompt)
print(response)
```

#### 問題(2)：文本注意錯誤的細節。
```python
prompt = f"""
Your task is to help a marketing team create a 
description for a retail website of a product based 
on a technical fact sheet.

Write a product description based on the information 
provided in the technical specifications delimited by 
triple backticks.

The description is intended for furniture retailers, 
so should be technical in nature and focus on the 
materials the product is constructed from.

Use at most 50 words.

Technical specifications: ```{fact_sheet_chair}```
"""
response = get_completion(prompt)
print(response)
```
加上列出產品 ID。
```python
prompt = f"""
Your task is to help a marketing team create a 
description for a retail website of a product based 
on a technical fact sheet.

Write a product description based on the information 
provided in the technical specifications delimited by 
triple backticks.

The description is intended for furniture retailers, 
so should be technical in nature and focus on the 
materials the product is constructed from.

At the end of the description, include every 7-character 
Product ID in the technical specification.

Use at most 50 words.

Technical specifications: ```{fact_sheet_chair}```
"""
response = get_completion(prompt)
print(response)
```

#### 問題(3)：描述需要尺寸表。
視任務而定地加入格式說明（如 HTML、JSON、表格等）
```python
prompt = f"""
Your task is to help a marketing team create a 
description for a retail website of a product based 
on a technical fact sheet.

Write a product description based on the information 
provided in the technical specifications delimited by 
triple backticks.

The description is intended for furniture retailers, 
so should be technical in nature and focus on the 
materials the product is constructed from.

At the end of the description, include every 7-character 
Product ID in the technical specification.

After the description, include a table that gives the 
product's dimensions. The table should have two columns.
In the first column include the name of the dimension. 
In the second column include the measurements in inches only.

Give the table the title 'Product Dimensions'.

Format everything as HTML that can be used in a website. 
Place the description in a <div> element.

Technical specifications: ```{fact_sheet_chair}```
"""

response = get_completion(prompt)
print(response)
```
載入 Python 庫來查看 HTML
```python
from IPython.display import display, HTML
```
```python
display(HTML(response))
```


---

